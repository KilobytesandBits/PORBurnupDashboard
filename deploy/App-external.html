<!DOCTYPE html>
<html>
<head>
    <title>PORBurnupDashboard</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                var types=Ext.data.Types;Ext.define("MilestoneTreeModel",{extend:"Ext.data.TreeModel",fields:[{name:"ObjectID",mapping:"ObjectID",type:types.STRING},{name:"FormattedID",mapping:"FormattedID",type:types.STRING},{name:"Name",mapping:"Name",type:types.STRING},{name:"StartDate",mapping:"ActualStartDate",type:types.DATE},{name:"ActiveStartDate",mapping:"ActiveStartDate",type:types.DATE},{name:"TargetDate",mapping:"AcceptedDate",type:types.DATE},{name:"TargetProject",mapping:"TargetProject",type:types.OBJECT},{name:"ValueStream",mapping:"ValueStream",type:types.STRING},{name:"Visibility",mapping:"Visibility",type:types.STRING},{name:"AdditionalReferences",mapping:"AdditionalReferences",type:types.STRING},{name:"Status",mapping:"Status",type:types.STRING},{name:"DisplayColor",mapping:"DisplayColor",type:types.STRING},{name:"Notes",mapping:"Notes",type:types.STRING},{name:"_ref",mapping:"_ref",type:types.STRING},{name:"AcceptedLeafStoryCount",mapping:"AcceptedLeafStoryCount",type:types.STRING},{name:"LeafStoryCount",mapping:"LeafStoryCount",type:types.STRING},{name:"FeaturesWithoutChildrenCount",mapping:"FeaturesWithoutChildrenCount",type:types.INT},{name:"StoryProgressPercent",mapping:"StoryProgressPercent",type:types.FLOAT},{name:"AssociatedTeams",mapping:"AssociatedTeams",type:types.STRING}],hasMany:{model:"FeatureTreeModel",name:"features",associationKey:"features"}}),Ext.define("MilestoneDataModel",{extend:"Ext.data.Model",fields:[{name:"ObjectID",mapping:"ObjectID",type:types.STRING},{name:"FormattedID",mapping:"FormattedID",type:types.STRING},{name:"Name",mapping:"Name",type:types.STRING},{name:"ActiveStartDate",mapping:"ActiveStartDate",type:types.DATE},{name:"StartDate",mapping:"ActualStartDate",type:types.DATE},{name:"TargetDate",mapping:"AcceptedDate",type:types.DATE},{name:"TargetProject",mapping:"TargetProject",type:types.OBJECT},{name:"ValueStream",mapping:"ValueStream",type:types.STRING},{name:"Visibility",mapping:"Visibility",type:types.STRING},{name:"AdditionalReferences",mapping:"AdditionalReferences",type:types.STRING},{name:"Status",mapping:"Status",type:types.STRING},{name:"DisplayColor",mapping:"DisplayColor",type:types.STRING},{name:"Notes",mapping:"Notes",type:types.STRING},{name:"_ref",mapping:"_ref",type:types.STRING},{name:"AcceptedLeafStoryCount",mapping:"AcceptedLeafStoryCount",type:types.INT},{name:"LeafStoryCount",mapping:"LeafStoryCount",type:types.INT},{name:"FeaturesWithoutChildrenCount",mapping:"FeaturesWithoutChildrenCount",type:types.INT},{name:"StoryProgressPercent",mapping:"StoryProgressPercent",type:types.FLOAT},{name:"AssociatedTeams",mapping:"AssociatedTeams",type:types.STRING}]}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",config:{defaultSettings:{valueStreamPicker:"FPA,Integration,Healthcare",teamPicker:"/project/3874483234,/project/7418464221,/project/9618552669,/project/2508024112,/project/3574043643,/project/2720145837"}},getSettingsFields:function(){return[{name:"includeGlobalMilestones",xtype:"rallycheckboxfield",fieldLabel:"",boxLabel:"Include global milestones"},{name:"showNumberOfMonths",xtype:"rallynumberfield",fieldLabel:"Date Range (months)"},{name:"valueStreamPicker",xtype:"rallyfieldvaluecombobox",model:"Milestone",field:"c_ValueStream",fieldLabel:"Value Stream",allowNoEntry:!0,multiSelect:!0},{name:"teamPicker",xtype:"rallymultiobjectpicker",overflowY:"auto",modelType:"Project",fieldLabel:"Associated Teams",filterFieldName:"Name",storeConfig:{autoLoad:!1,fetch:["Name","State"],pageSize:200,context:{project:"/project/1694641494",projectScopeUp:!1,projectScopeDown:!0},filters:[{Property:"State",operator:"=",Value:"Open"}],sorters:[{property:"Name",direction:"ASC"}],remoteGroup:!1,remoteSort:!1,remoteFilter:!1,limit:1/0},listCfg:{displayField:"Name"},stateful:!1}]},items:[{xtype:"container",itemId:"filterContainer",id:"filterContainer",layout:{type:"hbox",align:"left"}},{xtype:"container",itemId:"gridContainer",id:"gridContainer"}],launch:function(){var teamSelected=this.getSetting("teamPicker");console.log("Get team selected Values: ",teamSelected);var executiveVisibityFilter={xtype:"rallycheckboxfield",id:"executiveVisibilityCheckbox",boxLabel:"Show Executive Visibility Only",labelWidth:200,padding:"10, 5, 10, 5",checked:!1,listeners:{change:this._onReady,scope:this}},teamFilter={xtype:"rallymultiobjectpicker",id:"teamFilterMultiPicker",padding:"10, 5, 10, 5",modelType:"Project",fieldLabel:"Teams",labelAlign:"right",width:400,filterFieldName:"Name",listCfg:{displayField:"Name"},stateful:!1,listeners:{selectionchange:function(picker,values,eOpts){null!==values&&(this.selectedMultiTeamFilter=this._getProjectRefString(values),picker.setValue(values),this._setFilterMessage(!1))},scope:this}},valuestreamFilter={name:"valueStreamPicker",id:"customValueStreamPicker",xtype:"rallyfieldvaluecombobox",padding:"10, 5, 10, 5",model:"Milestone",field:"c_ValueStream",fieldLabel:"ValueStreams",labelAlign:"right",emptyText:"click to select",multiSelect:!0,width:400,listeners:{select:function(combo,records,eOpts){null!==records&&(this.selectedMultiVSFilter=this._getValueStreamString(records),combo.setValue(records),this._setFilterMessage(!1))},scope:this}},filterButton={name:"milestoneFilterButton",id:"milestoneFilterButton",xtype:"rallybutton",text:"Filter",margin:"5, 0, 0, 10",padding:"5, 5, 5, 5",width:50,handler:function(){this._onReady()},scope:this},filterPanelContaier={xtype:"container",itemId:"filterPanelContainer",id:"filterPanelContainer",layout:{type:"hbox",align:"left"},items:[executiveVisibityFilter,teamFilter,valuestreamFilter,filterButton]},filterMessageDisplay={xtype:"label",id:"filterMessage",html:"<div>Loading Milestones for filtered ValueStreams and Teams.........</div>",margin:"0 0 0 10"},filterPanel={xtype:"panel",width:"98%",margin:"10 5 10 5",collapsible:!0,layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"panel",width:"98%",margin:"0 0 5 5",title:"Filters",layout:{type:"vbox",align:"stretch",padding:5},items:[filterPanelContaier,{xtype:"panel",width:"98%",margin:"0 0 5 5",title:"Filter Criteria",layout:{type:"vbox",align:"stretch",padding:5},items:[filterMessageDisplay]}]}]};this.down("#filterContainer").add(filterPanel),this._getAllValidWorkspaceProjects()},_getAllValidWorkspaceProjects:function(){this.allWorkspaceProjectColl=[];var projectStore=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:["Name","State","_ref"],autoLoad:!0,compact:!1,context:{workspace:this.getContext().getWorkspace()._Ref,projectScopeUp:!1,projectScopeDown:!0},limit:1/0,filters:[{property:"State",operator:"=",value:"Open"}],sorters:[{property:"Name",direction:"ASC"}],listeners:{load:function(store,data,success){var that=this;console.log("Project Data: ",data),Ext.getBody().mask("Loading..."),Ext.Array.each(data,function(projData){var name=projData.get("Name"),ref=projData.get("_ref");that.allWorkspaceProjectColl.push({key:ref,value:name})}),console.log("All Execution Project Coll: ",this.allWorkspaceProjectColl),this._setDefaultFilteringValues(),this._setFilterMessage(!0),this._loadAllMilestones()},scope:this}})},_setFilterMessage:function(isDefaultValues){var vsValues=isDefaultValues?this.defaultValueStreamSetting:null!==this.selectedMultiVSFilter&&void 0!==this.selectedMultiVSFilter&&""!==this.selectedMultiVSFilter?this.selectedMultiVSFilter:this.defaultValueStreamSetting,teamRefValues=isDefaultValues?this.defaultTeamFilterSetting:null!==this.selectedMultiTeamFilter&&void 0!==this.selectedMultiTeamFilter&&""!==this.selectedMultiTeamFilter?this.selectedMultiTeamFilter:this.defaultTeamFilterSetting,vsNameValues=null!==vsValues&&void 0!==vsValues?vsValues:"No Values Streams selected",teamNameValues=null!==teamRefValues&&void 0!==teamRefValues?this._getProjectName(teamRefValues):"No Teams selected",filterMsg="<div>Determing Milestones for ValueStream(s): <b>"+vsNameValues+"</b> and Team(s): <b>"+teamNameValues+"</b></div>";Ext.getCmp("filterMessage").update(filterMsg)},_getProjectName:function(teamRefValues){var projNameStrColl="",teamRefColl=teamRefValues.split(","),that=this;return Ext.Array.each(teamRefColl,function(projRef){var projName=that._searchProjectByRef(projRef);""!==projName&&(projNameStrColl=projNameStrColl+projName+", ")}),""!==projNameStrColl&&projNameStrColl.length>1?projNameStrColl.substring(0,projNameStrColl.length-2):"No Project found"},_searchProjectByRef:function(ref){var name="";return Ext.Array.each(this.allWorkspaceProjectColl,function(thisProj){return thisProj.key===ref?(name=thisProj.value,void 0):void 0}),name},_setDefaultFilteringValues:function(){var loggedUser=this.getContext().getUser();switch(console.log("Logged User Name: ",loggedUser.UserName),loggedUser.UserName){case"arpan.bandyopadhyay@lexmark.com":this.isDefaultUserSettingPresent=!0,this.defaultValueStreamSetting="FPA,Integration",this.defaultTeamFilterSetting="/project/5822498311,/project/5103590994,/project/12207383723";break;case"deepan.biswas@lexmark.com":this.isDefaultUserSettingPresent=!0,this.defaultValueStreamSetting="FPA,Integration,Healthcare",this.defaultTeamFilterSetting="/project/3874483234,/project/7418464221,/project/9618552669,/project/2508024112,/project/3574043643,/project/2720145837";break;default:this.isDefaultUserSettingPresent=!0,this.defaultValueStreamSetting="FPA,Integration,Healthcare",this.defaultTeamFilterSetting="/project/3874483234,/project/7418464221,/project/9618552669,/project/2508024112,/project/3574043643,/project/2720145837"}},_getValueStreamString:function(records){var valuesteams="";return Ext.Array.each(records,function(vsRec){null!==vsRec.get("name")&&(valuesteams=valuesteams+vsRec.get("name")+",")}),""!==valuesteams&&valuesteams.length>1?valuesteams.substring(0,valuesteams.length-1):valuesteams},_getProjectRefString:function(values){var teamList="";return Ext.Array.each(values,function(thisProject){null!==thisProject.get("_ref")&&(teamList=teamList+thisProject.get("_ref")+",")}),""!==teamList&&teamList.length>1?teamList.substring(0,teamList.length-1):teamList},_onReady:function(){this._loadAllMilestones()},_loadAllMilestones:function(){Ext.getBody().mask("Loading..."),this._createMilestoneStoreFilter();var milsetoneStore=Ext.create("Rally.data.wsapi.Store",{model:"milestone",autoLoad:!0,compact:!1,filters:this.projectMilestoneFilter,sorters:[{property:"c_ValueStream",direction:"ASC"},{property:"TargetDate",direction:"ASC"}]});this.milestoneArtifactMappingColl=[],this.featureUserStoriesMappingColl=[],this.milestoneUserStoriesMappingColl=[],this.milestoneFeatureWithoutChildrenCountMappingColl=[],this.filteredMilestoneDataCollection=[],milsetoneStore.load().then({success:this._loadArtifacts,error:function(error){console.log("error loading milestone artifacts!")},scope:this}).then({success:this._loadAllHierarchicalRequirements,scope:this}).then({success:function(usRecords){if(null!==usRecords&&void 0!==usRecords&&usRecords.length>0){for(var i=0;usRecords.length>i;i++){var feature=this.featureArtifactColl[i];this.featureUserStoriesMappingColl.push({key:feature,value:usRecords[i]})}this._loadMilestoneUserStoriesFromMapping(),this._createMilestoneDataModelForDisplay(),console.log("Filtered Milestone Data: ",this.filteredMilestoneDataCollection),null!==this.filteredMilestoneDataCollection&&void 0!==this.filteredMilestoneDataCollection&&this.filteredMilestoneDataCollection.length>0?this._organiseMilestoneBasedOnValuestream(this.filteredMilestoneDataCollection):this._displayWithoutOutMilestones()}else this._displayWithoutOutMilestones()},failure:function(error){console.log("Error loading milestones!"),Ext.getBody().unmask()},scope:this})},_displayWithoutOutMilestones:function(){var gridContainer=this.getComponent("gridContainer");null!==gridContainer&&(gridContainer.removeAll(!0),gridContainer.add({xtype:"panel",width:"98%",margin:"0 0 5 5",title:"Miletsone Dashboard",layout:{type:"vbox",align:"stretch",padding:5},items:[{xtype:"label",text:"Sorry! No Milestone records found. Please try with different settings.",margin:"0 0 0 10"}]})),Ext.getBody().unmask()},_createMilestoneDataModelForDisplay:function(){var that=this;_.each(this.milestoneUserStoriesMappingColl,function(milestoneUSRec){var milestoneRec=milestoneUSRec.key,usRecColl=milestoneUSRec.value,featuresWithoutChildrenCount=that._getCountOfMilestoneFeaturesWithoutChildren(milestoneRec),milestoneComputeResult=that._performAllMilestoneComputaion(usRecColl,featuresWithoutChildrenCount),isValid=that._isMilestoneValidForDisplay(milestoneRec,milestoneComputeResult);if(isValid){var milestoneCustomData=that._createCustomMilestoneData(milestoneRec,milestoneComputeResult);that.filteredMilestoneDataCollection.push(milestoneCustomData)}})},_getAllAssociatedUserStoriesForMilestone:function(selectedMilestoneId){var that=this,selectedUSRecColl=[];return console.log("MI and US Mapping Coll: ",this.milestoneArtifactMappingColl),console.log("selectedMilestoneId: ",selectedMilestoneId),_.each(this.milestoneUserStoriesMappingColl,function(milestoneUSRec){var milestoneRec=milestoneUSRec.key,milestoneUSColl=milestoneUSRec.value,milestoneId=milestoneRec.get("ObjectID");return milestoneUSColl.length>0&&(6===milestoneUSColl.length||3===milestoneUSColl.length)&&(console.log("Matching Records: ",milestoneRec),console.log("Matching US Records: ",milestoneUSColl),console.log("Lookingup MI Records: ",milestoneId)),_.isEqual(milestoneId,selectedMilestoneId)?(selectedUSRecColl=milestoneUSColl,console.log("Mapping US Rec: ",selectedUSRecColl),selectedUSRecColl):void 0}),selectedUSRecColl},_organiseMilestoneBasedOnValuestream:function(filteredMilestonesArr){this.valueStreamMilestoneColl=[],this.valueStreamColl=[];var nonVSCount=0,that=this;Ext.Array.each(filteredMilestonesArr,function(thisData){var valuestream=thisData.get("ValueStream");null!==valuestream&&""!==valuestream?0===that.valueStreamColl.length?that.valueStreamColl.push(valuestream):that.valueStreamColl.length>0&&-1===that.valueStreamColl.indexOf(valuestream)&&that.valueStreamColl.push(valuestream):nonVSCount++}),this.valueStreamColl.sort(),nonVSCount>0&&this.valueStreamColl.push("N/A"),Ext.Array.each(this.valueStreamColl,function(valuestream){var milestoneColl=that._getAllAssociatedMilestones(valuestream,filteredMilestonesArr);that.valueStreamMilestoneColl.push({key:valuestream,value:milestoneColl})}),this._createValueStreamMilestonesTreeNode()},_createValueStreamMilestonesTreeNode:function(){var valueStreamRootNode=Ext.create("MilestoneTreeModel",{Name:"ValueStream Root",text:"ValueStream Root",root:!0,expandable:!0,expanded:!0});this._createValueStreamNodesAlongWithAssociatedChildMilestoneNodes(valueStreamRootNode),this._createValueStreamMilestoneGrid(valueStreamRootNode)},_createValueStreamNodesAlongWithAssociatedChildMilestoneNodes:function(valustreamRootNode){var that=this;Ext.Array.each(this.valueStreamMilestoneColl,function(thisData){var valueStreamNode=that._createValueStreamNode(thisData.key);Ext.Array.each(thisData.value,function(thisMilestoneData){var milestoneNode=that._createMilestoneNode(thisMilestoneData);valueStreamNode.appendChild(milestoneNode)}),valustreamRootNode.appendChild(valueStreamNode)})},_createValueStreamNode:function(valuestreamData){var valueStreamLable="valuestream: "+valuestreamData,valustreamTreeNode=Ext.create("MilestoneTreeModel",{Name:valueStreamLable,AcceptedLeafStoryCount:"",LeafStoryCount:"",StoryProgressPercent:"",leaf:!1,expandable:!0,expanded:!0,iconCls:"no-icon"});return valustreamTreeNode},_createMilestoneNode:function(milestoneData){var targetProjectName=null!==milestoneData.get("TargetProject")?milestoneData.get("TargetProject")._refObjectName:"Global",milestoneTreeNode=Ext.create("MilestoneTreeModel",{ObjectID:milestoneData.get("ObjectID"),FormattedID:milestoneData.get("FormattedID"),Name:milestoneData.get("Name"),StartDate:milestoneData.get("StartDate"),ActiveStartDate:milestoneData.get("ActiveStartDate"),TargetDate:milestoneData.get("TargetDate"),TargetProject:targetProjectName,DisplayColor:milestoneData.get("DisplayColor"),Notes:milestoneData.get("Notes"),AdditionalReferences:milestoneData.get("AdditionalReferences"),AssociatedTeams:milestoneData.get("AssociatedTeams"),_ref:milestoneData.get("_ref"),AcceptedLeafStoryCount:""+milestoneData.get("AcceptedLeafStoryCount"),LeafStoryCount:""+milestoneData.get("LeafStoryCount"),StoryProgressPercent:""+milestoneData.get("StoryProgressPercent"),FeaturesWithoutChildrenCount:""+milestoneData.get("FeaturesWithoutChildrenCount"),leaf:!0,expandable:!1,expanded:!1,iconCls:"no-icon"});return milestoneTreeNode},_getAllAssociatedMilestones:function(valuestream,milestoneStoreData){var milestoneColl=[];return Ext.Array.each(milestoneStoreData,function(milestone){var vsRecord=milestone.get("ValueStream");vsRecord=null!==vsRecord&&""!==vsRecord?vsRecord:"N/A",vsRecord===valuestream&&milestoneColl.push(milestone)}),milestoneColl},_createValueStreamMilestoneGrid:function(valueStreamRootNode){console.log("createValueStreamMilestoneGrid calling.....");var milestonesTreePanel=Ext.getCmp("milestonesTreePanel");milestonesTreePanel&&milestonesTreePanel.destroy();var me=this,milestoneValueStreamTreeStore=Ext.create("Ext.data.TreeStore",{model:"MilestoneTreeModel",root:valueStreamRootNode});this.chartDiag=Ext.create("Rally.ui.dialog.Dialog",{autoShow:!1,draggable:!1,closable:!0,closeAction:"hide",padding:10,width:800,height:500,autoScroll:!0,id:"Burnup_Chart_Diag"}),this.chartDiag.hide(),this.projWiseStatusDiag=Ext.create("Rally.ui.dialog.Dialog",{autoShow:!1,draggable:!1,closable:!0,closeAction:"hide",padding:10,width:800,height:500,autoScroll:!0,id:"Project_Wise_Status_Diag"}),this.projWiseStatusDiag.hide();var valuestreamMilestoneTreePanel=Ext.create("Ext.tree.Panel",{id:"milestonesTreePanel",itemId:"milestonesTreePanel",store:milestoneValueStreamTreeStore,useArrows:!0,rowLines:!0,displayField:"Name",rootVisible:!1,viewConfig:{getRowClass:function(record,index){var nameRecord=Ext.String.format("{0}",record.get("Name"));return nameRecord&&-1===nameRecord.search("valuestream:")?"row-child":"row-parent"}},columns:[{xtype:"treecolumn",text:"Name",dataIndex:"Name",resizeable:!0,flex:3,minWidth:200,renderer:function(value,style,item,rowIndex){var link=Ext.String.format("{0}",value);if(-1===link.search("valuestream:")){var ref=item.get("_ref");link=Ext.String.format("<a target='_top' href='{1}'><b>{0}</b></a>",value,Rally.nav.Manager.getDetailUrl(ref))}else{var onlyName=link.replace("valuestream:","");link=Ext.String.format("<b>{0}</b>",onlyName)}return link}},{text:"Project",dataIndex:"TargetProject",flex:2,hidden:!0},{text:"Start Date",dataIndex:"StartDate",flex:1,renderer:function(value){return value?Rally.util.DateTime.format(value,"m/d/Y"):void 0},hidden:!0},{text:"Target Date",dataIndex:"TargetDate",flex:1,renderer:function(value){if(value){var formattedDate=Rally.util.DateTime.format(value,"M Y"),formattedField;return formattedField=new Date>value?Ext.String.format("<div style='color:grey'>{0}</div>",formattedDate):Ext.String.format("<div>{0}</div>",formattedDate)}}},{xtype:"templatecolumn",text:"Progress",dataIndex:"StoryProgressPercent",tooltip:"click to view details.",tpl:Ext.create("Rally.ui.renderer.template.progressbar.ProgressBarTemplate",{percentDoneName:"StoryProgressPercent",showOnlyIfInProgress:!0,showDangerNotificationFn:function(value){return value.FeaturesWithoutChildrenCount>0?!0:!1},calculateColorFn:function(value){var targetDate=value.TargetDate,per=0,colorHex="#77D38D";return value.StoryProgressPercent&&targetDate&&(per=parseFloat(value.StoryProgressPercent),colorHex=me._getPercentDoneColor(targetDate,value.StartDate,value.StoryProgressPercent)),colorHex}}),flex:1},{text:"Accepted Count",dataIndex:"AcceptedLeafStoryCount",flex:1},{text:"Story Count",dataIndex:"LeafStoryCount",flex:1},{text:"Status",dataIndex:"DisplayColor",flex:1,hidden:!0,renderer:function(value){if(value){var colorHtml=Ext.String.format("<div class= 'color-box' style= 'background-color: {0};'></div>",value);return colorHtml}}},{text:"Teams",dataIndex:"AssociatedTeams",flex:1},{text:"Notes",dataIndex:"Notes",flex:4},{xtype:"actioncolumn",text:"References",width:50,items:[{icon:"https://cdn3.iconfinder.com/data/icons/fatcow/16x16_0620/page_link.png",tooltip:"References",getClass:this._displayIconForRow,width:75,handler:function(grid,rowIndex,colIndex){var record=grid.getStore().getAt(rowIndex);if(null!==record.get("FormattedID")&&""!==record.get("FormattedID")){var dialogTitle=record.get("FormattedID")+": Additional References";if(null!==record.get("AdditionalReferences")&&""!==record.get("AdditionalReferences"))var chartDiag=Ext.create("Rally.ui.dialog.Dialog",{autoShow:!0,draggable:!1,closable:!0,closeAction:"destroy",padding:10,width:800,title:dialogTitle});else Ext.Msg.alert(dialogTitle,"Sorry! There are NO reference mentioned.")}else Ext.Msg.alert("Reference","No Reference is available for valuestream item. Please click on individual milstone reference icon to get the references.")}}]},{xtype:"actioncolumn",text:"Chart",width:50,items:[{icon:"https://cdn4.iconfinder.com/data/icons/6x16-free-application-icons/16/3d_bar_chart.png",tooltip:"Burnup Chart",getClass:this._displayIconForRow,width:75,handler:function(grid,rowIndex,colIndex){var record=grid.getStore().getAt(rowIndex);if(null!==record.get("FormattedID")&&""!==record.get("FormattedID")){var dialogTitle=record.get("FormattedID")+": Burnup Chart";me.chartDiag.setTitle(dialogTitle),me.chartDiag.removeAll(!0),me.chartDiag.show(),me._getMilestoneBurnupChart(record,me.chartDiag)}else Ext.Msg.alert("Burnup Chart","No Chart is available for valuestream item. Please click on individual milstone chart icon to get the chart.")}}]},{xtype:"actioncolumn",text:"Project Wise User Story View",width:50,items:[{icon:"https://cdn4.iconfinder.com/data/icons/munich/16x16/project.png",tooltip:"Milestone Project Wise User Story View",getClass:this._displayIconForRow,width:75,handler:function(grid,rowIndex,colIndex){var record=grid.getStore().getAt(rowIndex);if(null!==record.get("FormattedID")&&""!==record.get("FormattedID")){var dialogTitle=record.get("FormattedID")+": Milestone Project Wise User Story View";me.projWiseStatusDiag.setTitle(dialogTitle),me.projWiseStatusDiag.removeAll(!0),me.projWiseStatusDiag.show(),me._getMilestoneProjectWiseView(record,me.projWiseStatusDiag)}else Ext.Msg.alert("Project Wise Status","No Project Wise User Story View is available for valuestream item. Please click on individual milstone chart icon to get the view.")}}]}]});valuestreamMilestoneTreePanel.on({cellclick:{fn:this._onTreePanelItemClick,scope:this}});var gridContainer=this.getComponent("gridContainer");null!==gridContainer&&(gridContainer.removeAll(!0),gridContainer.add({xtype:"panel",width:"98%",margin:"0 0 5 5",title:"Miletsone Dashboard",layout:{type:"vbox",align:"stretch",padding:5},items:[valuestreamMilestoneTreePanel]})),Ext.getBody().unmask()},_displayIconForRow:function(v,metadata,r,rowIndex,colIndex,store){var name=r.get("Name"),className="hide-icon";return-1===name.search("valuestream:")&&(className="show-icon"),className},_isMilestoneValidForDisplay:function(milestoneRec,milestoneComputeResult){var isValid=!0,storyInfo=milestoneComputeResult.storyInfo,projColl=milestoneComputeResult.projectColl,targetDate=milestoneRec.get("TargetDate");if(storyInfo.storyCount>0&&storyInfo.storyCount===storyInfo.acceptedCount&&""!==targetDate&&new Date>=targetDate&&(isValid=!1),isValid){var teamPickerSelected=this._getTeamFilterSelectionValue();null!==teamPickerSelected&&void 0!==teamPickerSelected&&""!==teamPickerSelected&&(isValid=this._isMilestoneDataAssociatedWitheSelectedTeams(teamPickerSelected,projColl))}return isValid},_getTeamFilterSelectionValue:function(){var teamPickerSelected=this.getSetting("teamPicker");return null!==this.selectedMultiTeamFilter&&void 0!==this.selectedMultiTeamFilter&&""!==this.selectedMultiTeamFilter?teamPickerSelected=this.selectedMultiTeamFilter:this.isDefaultUserSettingPresent&&null!==this.defaultTeamFilterSetting&&void 0!==this.defaultTeamFilterSetting&&null!==this.defaultTeamFilterSetting&&(teamPickerSelected=this.defaultTeamFilterSetting),teamPickerSelected},_isMilestoneDataAssociatedWitheSelectedTeams:function(teamPickerSelection,associatedProj){var isPresent=!1,associatedProjRef=this._getAssociatedProjectRefColl(associatedProj);if(null===associatedProjRef||void 0===associatedProjRef)return!0;var teamFilters=teamPickerSelection.split(",");if(teamFilters.length>0&&null!==associatedProjRef&&void 0!==associatedProjRef&&associatedProjRef.length>0)for(var i=0;teamFilters.length>i;i++)if(associatedProjRef.indexOf(teamFilters[i])>-1){isPresent=!0;break}return isPresent},_getAssociatedProjectNameCollString:function(projColl){var nameColl=[];Ext.Array.each(projColl,function(thisProject){_.contains(nameColl,thisProject.Name)||nameColl.push(thisProject.Name)});var nameStr="";return Ext.Array.each(nameColl,function(thisProjectName){nameStr=nameStr+thisProjectName+","}),""!==nameStr&&nameStr.length>1?nameStr.substring(0,nameStr.length-1):nameStr},_getAssociatedProjectRefColl:function(projColl){var refColl=[];return Ext.Array.each(projColl,function(thisProject){_.contains(refColl,thisProject._ref)||refColl.push(thisProject._ref)}),refColl},_getCountOfMilestoneFeaturesWithoutChildren:function(milestone){var count=0;return _.each(this.milestoneFeatureWithoutChildrenCountMappingColl,function(milestoneCollRec){var milestoneRec=milestoneCollRec.key,noChildCount=milestoneCollRec.value;return milestoneRec.get("ObjectID")===milestone.get("ObjectID")?(count=null!==noChildCount&&void 0!==noChildCount?noChildCount:0,void 0):void 0}),count},_performAllMilestoneComputaion:function(usColl,featureWithoutChildCount){var milestoneStoryInfo={storyInfo:[],projectColl:[]},storyCountInfo={storyCount:0,acceptedCount:0,startDate:null,featureNotBrokenCount:featureWithoutChildCount},projColl=[],leafStoryCount=0,acceptedLeafStoryCount=0,startDate=null;return _.each(usColl,function(us){leafStoryCount+=1;var scheduleState=us.get("ScheduleState");"Accepted"===scheduleState&&(acceptedLeafStoryCount+=1);var inProgressDate=us.get("InProgressDate");(null===startDate||startDate>inProgressDate)&&(startDate=inProgressDate);var proj=us.get("Project");null===proj||_.contains(projColl,proj)||projColl.push(proj)}),storyCountInfo.storyCount=leafStoryCount,storyCountInfo.acceptedCount=acceptedLeafStoryCount,storyCountInfo.startDate=startDate,milestoneStoryInfo.storyInfo=storyCountInfo,milestoneStoryInfo.projectColl=projColl,milestoneStoryInfo},_getAllProjectsAssociatedWithMilestone:function(usColl){var projColl=[];return _.each(usColl,function(us){var proj=us.get("Project");null===proj||_.contains(projColl,proj)||projColl.push(proj)}),projColl},_createCustomMilestoneData:function(milestoneItem,milestoneComputeResult){var storyCountInfo=milestoneComputeResult.storyInfo,projColl=milestoneComputeResult.projectColl,projectNameList=this._getAssociatedProjectNameCollString(projColl),milestoneData=Ext.create("MilestoneDataModel",{ObjectID:milestoneItem.get("ObjectID"),FormattedID:milestoneItem.get("FormattedID"),Name:milestoneItem.get("Name"),StartDate:storyCountInfo.startDate,ActiveStartDate:milestoneItem.get("c_ActiveStartDate"),TargetDate:milestoneItem.get("TargetDate"),TargetProject:milestoneItem.get("Name"),ValueStream:milestoneItem.get("c_ValueStream"),AdditionalReferences:milestoneItem.get("c_AdditionalReferences"),Visibility:milestoneItem.get("c_ExecutiveVisibility"),Status:milestoneItem.get("c_Test"),DisplayColor:milestoneItem.get("DisplayColor"),Notes:milestoneItem.get("Notes"),_ref:milestoneItem.get("_ref"),AssociatedTeams:projectNameList,AcceptedLeafStoryCount:storyCountInfo.acceptedCount,LeafStoryCount:storyCountInfo.storyCount,FeaturesWithoutChildrenCount:storyCountInfo.featureNotBrokenCount,StoryProgressPercent:storyCountInfo.storyCount>0?storyCountInfo.acceptedCount/storyCountInfo.storyCount:0});return milestoneData},_loadMilestoneUserStoriesFromMapping:function(){var that=this,featureWithoutChildCount=0;_.each(this.milestoneArtifactMappingColl,function(milestoneArtifactCollRec){var userStoriesColl=[],milestoneRec=milestoneArtifactCollRec.key,artifactColl=milestoneArtifactCollRec.value;if(artifactColl.length>0){featureWithoutChildCount=0;var me=that;_.each(artifactColl,function(artifact){var itemType=artifact.get("_type");if("hierarchicalrequirement"!==itemType&&"defect"!==itemType){0===artifact.get("LeafStoryCount")&&(featureWithoutChildCount+=1);var usColl=me._getUserStoriesForFeatures(artifact);_.each(usColl,function(us){userStoriesColl.push(us)})}else userStoriesColl.push(artifact)})}that.milestoneFeatureWithoutChildrenCountMappingColl.push({key:milestoneRec,value:featureWithoutChildCount}),that.milestoneUserStoriesMappingColl.push({key:milestoneRec,value:userStoriesColl})})},_getUserStoriesForFeatures:function(artifact){var usColl=[];return _.each(this.featureUserStoriesMappingColl,function(featureUSRec){var feature=featureUSRec.key,userStoriesColl=featureUSRec.value;return feature.get("ObjectID")===artifact.get("ObjectID")?(usColl=userStoriesColl,void 0):void 0}),usColl},_createMilestoneStoreFilter:function(){if(console.log("creating milestone filter...!"),this.projectMilestoneFilter=Ext.create("Rally.data.wsapi.Filter",{property:"TargetDate",operator:">=",value:"today-15"}),this._getVisibilityFilter()&&(this.projectMilestoneFilter=this.projectMilestoneFilter.and(Ext.create("Rally.data.wsapi.Filter",{property:"c_ExecutiveVisibility",operator:"=",value:this._getVisibilityFilter()}))),this.getSetting("showNumberOfMonths")&&this.getSetting("showNumberOfMonths")>0){var endDate=Rally.util.DateTime.add(new Date,"month",this.getSetting("showNumberOfMonths"));this.projectMilestoneFilter=this.projectMilestoneFilter.and(Ext.create("Rally.data.wsapi.Filter",{property:"TargetDate",operator:"<=",value:endDate}))}var vsSelectedValues=this.getSetting("valueStreamPicker");null!==this.selectedMultiVSFilter&&void 0!==this.selectedMultiVSFilter&&this.selectedMultiVSFilter.length>0?vsSelectedValues=this.selectedMultiVSFilter:this.isDefaultUserSettingPresent&&null!==this.defaultValueStreamSetting&&void 0!==this.defaultValueStreamSetting&&""!==this.defaultValueStreamSetting&&(vsSelectedValues=this.defaultValueStreamSetting);var vsFilters=vsSelectedValues.split(",");if(this.projectMilestoneFilter=this.projectMilestoneFilter.and(Ext.create("Rally.data.wsapi.Filter",{property:"c_ValueStream",operator:"contains",value:vsFilters[0]})),vsFilters.length>1)for(var i=1;vsFilters.length>i;i++)this.projectMilestoneFilter=this.projectMilestoneFilter.or(Ext.create("Rally.data.wsapi.Filter",{property:"c_ValueStream",operator:"contains",value:vsFilters[i]}))},_loadArtifacts:function(milestoneRecords){console.log("Loading artifacts...!");var promises=[],that=this;return this.milestoneColl=milestoneRecords,console.log("Milestone records! ",this.milestoneColl),null!==this.milestoneColl&&this.milestoneColl.length>0?(Ext.Array.each(milestoneRecords,function(milestone){var artifactStore=Ext.create("Rally.data.wsapi.artifact.Store",{models:["portfolioitem/feature","defect","userstory"],context:{workspace:that.getContext().getWorkspace()._Ref,project:null,limit:1/0,projectScopeUp:!1,projectScopeDown:!0},filters:[{property:"Milestones.ObjectID",operator:"=",value:milestone.get("ObjectID")}]});promises.push(artifactStore.load())}),Deft.Promise.all(promises)):(console.log("No milestones records...so no artifacts!"),this._displayWithoutOutMilestones(),void 0)},_loadAllHierarchicalRequirements:function(artifactCollRecs){this.featureArtifactColl=[];var promises=[],that=this;if(null!==artifactCollRecs&&void 0!==artifactCollRecs&&artifactCollRecs.length>0){for(var i=0;artifactCollRecs.length>i;i++){var milestone=this.milestoneColl[i];this.milestoneArtifactMappingColl.push({key:milestone,value:artifactCollRecs[i]})}var artifactColl=_.flatten(artifactCollRecs);Ext.Array.each(artifactColl,function(artifact){var itemType=artifact.get("_type");
if("hierarchicalrequirement"==itemType||"defect"==itemType){var project=artifact.get("Project");project&&_.contains(that.allAssociatedProjectColl,project)&&that.allAssociatedProjectColl.push(project)}else{that.featureArtifactColl.push(artifact);var hierarchicalrequirementStore=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",fetch:["ObjectID","FormattedID","Name","Project","Feature","ScheduleState"],context:{workspace:that.getContext().getWorkspace()._Ref,project:null,limit:1/0,projectScopeUp:!1,projectScopeDown:!0},filters:[{property:"Feature.ObjectID",operator:"=",value:artifact.get("ObjectID")}]});promises.push(hierarchicalrequirementStore.load())}})}return Deft.Promise.all(promises)},_getVisibilityFilter:function(){var visibilityCheckBox=Ext.getCmp("executiveVisibilityCheckbox");return visibilityCheckBox.getValue()},_onTreePanelItemClick:function(view,td,cellIndex,record,tr,rowIndex){if(4===cellIndex){console.log("In side the Progress bar cell"),console.log("On Cell Click: Data Model is : ",record);var tooltipTitle="<h3>"+record.data.FormattedID+" : "+record.data.Name+"</h3>",htmlString=this._getTootipPopupContent(record),tooltip=Ext.create("Rally.ui.tooltip.ToolTip",{target:td,anchor:"left",items:[{xtype:"label",forId:"myFieldId",html:tooltipTitle,margin:"10 10 10 10"},{xtype:"form",bodyPadding:10,layout:"fit",items:[{xtype:"displayfield",fieldLabel:"Details",hideLabel:!0,name:"progress_details",value:htmlString,autoScroll:!0}]}],layout:{type:"vbox",align:"left"}});console.log("Tool Tip: ",tooltip)}},_getTootipPopupContent:function(record){var progressPercentage=100*record.data.StoryProgressPercent.toFixed(2),htmlstring="<h3>Progress:</h3>";htmlstring+="<p>Total Story Count: <span><strong>"+record.data.LeafStoryCount+"</strong></span></p>",htmlstring+="<p>Total Accepted Story Count: <span><strong>"+record.data.AcceptedLeafStoryCount+"</strong></span></p>",htmlstring+="<p>Percentage of Progress: <span><strong>"+progressPercentage+" %</strong></span></p>",htmlstring+="<hr>",record.data.FeaturesWithoutChildrenCount>0&&(htmlstring+='<h3 style="color:red;">Alerts:</h3>',htmlstring+='<p style="color:red; font-weight: bold;">There are <span><u>'+record.data.FeaturesWithoutChildrenCount+" Features</u></span> still not broken down into user stories.</p>",htmlstring+="<hr>");var targetDate=null!==record.data.TargetDate?Rally.util.DateTime.format(record.data.TargetDate,"m/d/Y"):"Not Mentioned",actualStartDate=null!==record.data.StartDate?Rally.util.DateTime.format(record.data.StartDate,"m/d/Y"):"Not Started";return htmlstring+="<h3>Info:</h3>",htmlstring+="<p>Milestone Target Date: <span><strong>"+targetDate+"</strong></p>",htmlstring+="<p>Milestone Actual Start Date: <span><strong>"+actualStartDate+"</strong></p>",htmlstring+="<hr>",htmlstring+="<h3>Notes: <h3>",htmlstring+='<p style="width: 100px; white-space: pre-line;">'+record.data.Notes+"</p>"},_onTreePanelItemMouseEnter:function(view,record,item,index){console.log("On Mouse Enter: record is : ",record),console.log("On Mouse Enter: column is : ",item),console.log("On Mouse Enter: index is : ",index)},_getPercentDoneColor:function(milestoneEndDate,milestoneStartDate,milestonePercentDone){var greenHex="#1B801D",yellowHex="#FFFF00",redHex="#FE2E2E",blueHex="#1874CD",whiteHex="#FFFFFF",startDate=null,endDate=null,asOfDate=new Date,percentComplete=100*milestonePercentDone;startDate=null!==milestoneStartDate?milestoneStartDate:asOfDate,endDate=null!==milestoneEndDate?milestoneEndDate:asOfDate;var dateDifference=Rally.util.DateTime.getDifference(endDate,startDate,"day"),startDateNumber=1,endDateNumber=startDateNumber+dateDifference,asOfDateNumber=Rally.util.DateTime.getDifference(asOfDate,startDate,"day")+1,acceptanceStartDelay=.2*(endDateNumber-startDateNumber),warningDelay=.2*(endDateNumber-startDateNumber),inProgress=percentComplete>0;if(startDate>asOfDate)return whiteHex;if(asOfDate>=endDate)return percentComplete>=100?blueHex:redHex;var redXIntercept=startDateNumber+acceptanceStartDelay+warningDelay,redSlope=100/(endDateNumber-redXIntercept),redYIntercept=-1*redXIntercept*redSlope,redThreshold=redSlope*asOfDateNumber+redYIntercept;if(redThreshold>percentComplete)return redHex;var yellowXIntercept=startDateNumber+acceptanceStartDelay,yellowSlope=100/(endDateNumber-yellowXIntercept),yellowYIntercept=-1*yellowXIntercept*yellowSlope,yellowThreshold=yellowSlope*asOfDateNumber+yellowYIntercept;return yellowThreshold>percentComplete?yellowHex:greenHex},_getMilestoneBurnupChart:function(milestoneRec,chartDiag){var chartDiagId=chartDiag.getId();null!==milestoneRec&&(console.log("milestoneData: ",milestoneRec),this.selectedMilestone=milestoneRec.get("ObjectID"),this.selectedMilestoneObj=milestoneRec,Ext.getCmp(chartDiagId).mask("Creating Burnup Chart for "+this.selectedMilestoneObj.get("FormattedID")+"..."),this._getBurnupChart(chartDiag))},_getBurnupChart:function(chartDiag){Deft.Promise.all([this._loadPIsInMilestone(),this._loadScheduleStateValues()]).then({success:function(){var burnupChart=this._getChart(!0,null,chartDiag);if(null!==burnupChart){chartDiag.removeAll(!0),chartDiag.add(burnupChart);var that=this;Ext.Array.each(this.piRecords,function(piRecord,index){var piBurnupChart=that._getChart(!1,piRecord,chartDiag);null!==piBurnupChart&&chartDiag.add(piBurnupChart)})}},scope:this})},_loadScheduleStateValues:function(){return Rally.data.ModelFactory.getModel({type:"UserStory",success:function(model){model.getField("ScheduleState").getAllowedValueStore().load({callback:function(records){this.scheduleStateValues=_.invoke(records,"get","StringValue")},scope:this})},scope:this})},_loadPIsInMilestone:function(){var that=this;return Ext.create("Rally.data.wsapi.artifact.Store",{models:["portfolioitem/feature","defect","userstory"],context:{workspace:that.getContext().getWorkspace()._Ref,project:null,limit:1/0,projectScopeUp:!1,projectScopeDown:!0},filters:[{property:"Milestones.ObjectID",operator:"=",value:that.selectedMilestone}]}).load().then({success:function(artifacts){this.piRecords=artifacts},scope:this})},_getChart:function(isMileStone,piRecord,chartDiag){var that=this,chartStartDate=""!==that.selectedMilestoneObj.get("ActiveStartDate")?that.selectedMilestoneObj.get("ActiveStartDate"):_.min(_.compact(_.invoke(that.piRecords,"get","ActualStartDate"))),chartEndDate=that.selectedMilestoneObj.get("TargetDate"),chart={xtype:"rallychart",flex:1,storeType:"Rally.data.lookback.SnapshotStore",storeConfig:isMileStone?that._getStoreConfig():that._getStoreConfigForPI(piRecord.data.ObjectID),calculatorType:"Rally.example.BurnCalculator",calculatorConfig:{completedScheduleStateNames:["Accepted","Released"],stateFieldValues:that.scheduleStateValues,startDate:chartStartDate,endDate:chartEndDate,enableProjects:!0},chartColors:["#A16E3A","#1B7F25","#B1B1B7","#2E2EAC"],chartConfig:that._getChartConfig(isMileStone,piRecord),listeners:{afterrender:function(obj,eOpts){Ext.getCmp(chartDiag.getId()).unmask()},scope:this}};return chart},_getStoreConfig:function(){return{find:{_TypeHierarchy:{$in:["HierarchicalRequirement"]},_ItemHierarchy:{$in:_.invoke(this.piRecords,"getId")}},fetch:["ScheduleState","PlanEstimate"],hydrate:["ScheduleState"],sort:{_ValidFrom:1},context:this.getContext().getDataContext(),limit:1/0}},_getStoreConfigForPI:function(piId){return{find:{_TypeHierarchy:{$in:["HierarchicalRequirement"]},_ItemHierarchy:piId},fetch:["ScheduleState","PlanEstimate"],hydrate:["ScheduleState"],sort:{_ValidFrom:1},context:this.getContext().getDataContext(),limit:1/0}},_getChartConfig:function(isMileStone,piRecord){return{chart:{defaultSeriesType:"area",zoomType:"xy"},title:{text:isMileStone?"Milestone Burnup":piRecord.data.FormattedID+" - "+piRecord.data.Name},xAxis:{categories:[],tickmarkPlacement:"on",tickInterval:5,title:{text:"Date",margin:10}},yAxis:[{title:{text:"Counts"}}],tooltip:{formatter:function(){return""+this.x+"<br />"+this.series.name+": "+Math.ceil(this.y)}},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},groupPadding:.01},column:{stacking:null,shadow:!1}}}},_getMilestoneProjectWiseView:function(milestoneRec,projWiseStatusDiag){var projWiseStatusDiagId=projWiseStatusDiag.getId();null!==milestoneRec&&(this.selectedMilestone=milestoneRec.get("ObjectID"),this.selectedMilestoneObj=milestoneRec,Ext.getCmp(projWiseStatusDiagId).mask("Creating Milestone Project Wise User Story View for "+this.selectedMilestoneObj.get("FormattedID")+"..."),this._loadProjectWiseViewArtifacts(projWiseStatusDiag))},_loadProjectWiseViewArtifacts:function(projWiseStatusDiag){var that=this;return Ext.create("Rally.data.wsapi.artifact.Store",{models:["portfolioitem/feature","userstory"],context:{workspace:that.getContext().getWorkspace()._Ref,project:null,limit:1/0,projectScopeUp:!1,projectScopeDown:!0},filters:[{property:"Milestones.ObjectID",operator:"=",value:that.selectedMilestone}]}).load().then({success:function(artifacts){this.artifactsData=artifacts,this._getProjectWiseViewGridData(projWiseStatusDiag)},scope:this})},_getProjectWiseViewGridData:function(projWiseStatusDiag){var that=this;Ext.create("Rally.data.wsapi.TreeStoreBuilder").build({model:["userstory"],autoLoad:!0,compact:!1,enableHierarchy:!0,context:{workspace:Rally.environment.getContext().getWorkspace()._ref,project:Rally.environment.getContext().getProject()._ref,projectScopeUp:!1,projectScopeDown:!0},filters:that._getProjectWiseViewGridFilter(),fetch:["FormattedID","Name","Feature","Project","ScheduleState"],limit:1/0,sorters:[{property:"Feature",direction:"ASC"}]}).then({success:function(store){that._drawProjectWiseViewGrid(store,projWiseStatusDiag)}})},_getProjectWiseViewGridFilter:function(){var filter=null;return Ext.Array.each(this.artifactsData,function(artifactData){filter="Feature"===artifactData.get("PortfolioItemTypeName")?null===filter?Ext.create("Rally.data.wsapi.Filter",{property:"Feature.ObjectID",operator:"=",value:artifactData.getId()}):filter.or(Ext.create("Rally.data.wsapi.Filter",{property:"Feature.ObjectID",operator:"=",value:artifactData.getId()})):null===filter?Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",operator:"=",value:artifactData.getId()}):filter.or(Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",operator:"=",value:artifactData.getId()}))}),filter},_drawProjectWiseViewGrid:function(gridStore,projWiseStatusDiag){var that=this;that.down("rallygridboard")&&that.down("rallygridboard").destroy(),projWiseStatusDiag.add({xtype:"rallygridboard",id:"gridData",modelNames:["userstory"],toggleState:"grid",stateful:!1,plugins:[{ptype:"rallygridboardactionsmenu",menuItems:[{text:"Export to csv",handler:function(){window.location=Rally.ui.grid.GridCsvExport.buildCsvExportUrl(projWiseStatusDiag.down("rallygridboard").getGridOrBoard())},scope:this},{text:"Print",handler:function(){Ext.create("Rally.ui.grid.TreeGridPrintDialog",{grid:projWiseStatusDiag.down("rallygridboard").getGridOrBoard(),treeGridPrinterConfig:{largeHeaderText:"Milestone Project Wise User Story View"}})},scope:this}],buttonConfig:{iconCls:"icon-export"}}],gridConfig:{columnCfgs:["FormattedID","Name","ScheduleState","Project","Feature"],store:gridStore,enableEditing:!1,enableRanking:!1,enableInlineAdd:!1,enableBulkEdit:!1,enableScheduleStateClickable:!1,showRowActionsColumn:!1},height:this.getHeight()}),Ext.getCmp(projWiseStatusDiag.getId()).unmask()}});
                Ext.define("Rally.example.BurnCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",config:{completedScheduleStateNames:["Accepted"]},constructor:function(config){this.initConfig(config),this.callParent(arguments)},getDerivedFieldsOnInput:function(){var completedScheduleStateNames=this.getCompletedScheduleStateNames();return[{as:"StoryCount",f:function(snapshot){return 1}},{as:"CompletedStoryCount",f:function(snapshot){var ss=snapshot.ScheduleState;return completedScheduleStateNames.indexOf(ss)>-1?1:0}}]},getDerivedFieldsAfterSummary:function(){var stateFieldValues=this.stateFieldValues;return[{as:"Ideal",f:function(row,index,summaryMetrics,seriesData){var data=_.last(seriesData),max=seriesData[seriesData.length-1].Planned,increments=seriesData.length-1,incrementAmount;return 0===increments?max:(incrementAmount=max/increments,Math.floor(100*index*incrementAmount)/100)},display:"line"},{as:"Actual",f:function(row,index,summaryMetrics,seriesData){var today=Rally.util.DateTime.toIsoString(new Date),endIndex=_.findIndex(seriesData,function(data){return data.tick>today});if(0>endIndex&&(endIndex=seriesData.length-1),endIndex>=index){var acceptedSeriesData=_.pluck(seriesData,"Completed"),slope=(acceptedSeriesData[0]-acceptedSeriesData[endIndex])/(0-endIndex);return index*slope}},display:"line"}]},getMetrics:function(){return[{field:"StoryCount",as:"Planned",display:"line",f:"sum"},{field:"CompletedStoryCount",as:"Completed",f:"sum",display:"column"}]}});

            Rally.launchApp('CustomApp', {
                name:"PORBurnupDashboard",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .ico-test-valustream{width:20px;height:20px;top:8px;background-image:url('https://cdn4.iconfinder.com/data/icons/stash/128/ruby-16.png') !important}.ico-test-milestone{width:20px;height:20px;top:8px;background-image:url('https://cdn1.iconfinder.com/data/icons/all_google_icons_symbols_by_carlosjj-du/16/milestone.png') !important}.color-box{width:15px;height:15px;display:inline-block;background-color:#ccc;position:relative;left:10px;top:0px}.show-icon{display:inline-block}.hide-icon{display:none}.no-icon{display:none;background-image:url('ext/resources/images/default/s.gif') !important}.row-parent .x-grid-cell{background-color:#77D38D !important}.x-grid-item-over .row-parent .x-grid-cell{background-color:#3da5f5 !important}.x-grid-item-selected .row-parent .x-grid-cell{background-color:#ff0 !important}.row-child .x-grid-cell{background-color:#FFFFFF !important}.x-grid-item-over .row-child .x-grid-cell{background-color:#C2FABA !important}.x-grid-item-selected .row-child .x-grid-cell{background-color:#80AA79 !important}
    </style>
</head>
<body>
</body>
</html>
